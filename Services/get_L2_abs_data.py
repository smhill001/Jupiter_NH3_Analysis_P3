# -*- coding: utf-8 -*-
def get_L2_abs_data(writecsv=False,writejson=False):
    """
    Created on Tue Aug 22 10:37:40 2023
    
    @author: smhil
    """
    import sys
    import numpy as np
    import json
    from astropy.table import  Table
    from astropy.io import ascii
    sys.path.append('./Services')
    import time
    import get_WINJupos_ephem as WJ_ephem
    import matplotlib.pyplot as pl


    sourcefiles={'20220730UTa_Map':{'Telescope':'VLT','FL':' ','Camera':'MUSE',
                                               'Seeing':'6/10','Transparency':'7/10', 
                               'CH4file':'2022-07-30-0729_8','CH4Qual':True,
                               'NH3file':'2022-07-30-0729_8','NH3Qual':True,
                               'RGBfile':'2022-07-30-0729_8-Jupiter_R650G550B480-MUSE-RGB-Str'},
                 '20220810UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                               'CH4file':'2022-08-10-1014_8','CH4Qual':False,
                               'NH3file':'2022-08-10-1013_0','NH3Qual':True,
                               'RGBfile':'2022-08-10-1030_0-Jupiter_WV-R(AllRED)GB-RGB-WhtBal-Wavelets-Str'},
                 '20220812UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                 'Seeing':'6/10','Transparency':'7/10', 
                               'CH4file':'2022-08-12-1025_5','CH4Qual':True,
                               'NH3file':'2022-08-12-1025_5','NH3Qual':False,
                               'RGBfile':'2022-08-12-1033_8-Jupiter_WV-R(AllRed)GB-RGB-WhtBal-Wavelets'},
                 '20220818UT':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                            'Seeing':'6/10','Transparency':'7/10', 
                               'CH4file':'2022-08-18-0734_3','CH4Qual':True,
                               'NH3file':'2022-08-18-0733_4','NH3Qual':True,
                               'RGBfile':'2022-08-18-0745_4-Jupiter_AllRED-WV-RGB-WhtBal-Wavelets'},
                 '20220818UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-08-18-0734_3','CH4Qual':False,
                                            'NH3file':'2022-08-18-0733_4','NH3Qual':True,
                                            'RGBfile':'2022-08-18-0745_4-Jupiter_AllRED-WV-RGB-WhtBal-Wavelets'},
                 '20220828UTa':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                           'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-08-28-0608_2-Jupiter_CH4Abs620.fits','CH4Qual':True,
                                            'NH3file':'2022-08-28-0608_2-Jupiter_NH3Abs647.fits','NH3Qual':True,
                                            'RGBfile':'NA'},
                 '20220828UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-08-28-0608_2','CH4Qual':True,
                                            'NH3file':'2022-08-28-0608_2','NH3Qual':True,
                                            'RGBfile':'2022-08-28-0601_3-Jupiter-RGB-JamesWillinghan-j220828a1'},
                 '20220830UTa_Img':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-08-30-0559_1-Jupiter_CH4Abs620.fits','CH4Qual':True,
                                            'NH3file':'2022-08-30-0559_1-Jupiter_NH3Abs647.fits','NH3Qual':True,
                                            'RGBfile':'2022-08-28-1429_7-Jupiter-RGB-Arakawa-j220828e1'},
                 '20220830UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-08-30-0559_2','CH4Qual':True,
                                            'NH3file':'2022-08-30-0559_1','NH3Qual':True,
                                            'RGBfile':'2022-08-28-1429_7-Jupiter-RGB-Arakawa-j220828e1'},
                 #!!! 7/16/2023: SOME SORT OF PROBLEM WITH CONTOUR LEVELS PREVENTS THIS FROM RUNNING; NEED TO RERUN
                 '20220901UTa_Img':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-01-0604_9-Jupiter_CH4Abs620.fits','CH4Qual':True,
                                            'NH3file':'2022-09-01-0604_9-Jupiter_NH3Abs647.fits','NH3Qual':True,
                                            'RGBfile':'NA'},
                 '20220901UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-01-0604_9','CH4Qual':True,
                                            'NH3file':'2022-09-01-0604_9','NH3Qual':True,
                                            'RGBfile':'2022-09-01-0618_0-Jupiter-Rivera-j220901l1'},
                 '20220904UTa_Img':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-04-0638_9-Jupiter_620CH4AbsImg.fits','CH4Qual':True, 
                                            'NH3file':'2022-09-04-0638_2-Jupiter_647NH3AbsImg.fits','NH3Qual':True,
                                            'RGBfile':'2022-09-04-1644_7-Jupiter-Yamane-j220904j4.jpg'},
                 '20220904UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-04-0638_9','CH4Qual':False,#issue with Zonal profile?
                                            'NH3file':'2022-09-04-0638_2','NH3Qual':True,
                                            'RGBfile':'2022-09-04-1644_7-Jupiter-Yamane-j220904j4'},
                 '20220905UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-05-0559_2','CH4Qual':True,
                                            'NH3file':'2022-09-05-0559_1','NH3Qual':True,
                                            'RGBfile':'2022-09-05-1559_0-Jupiter_j220905l1_Michael_Wong'},
                 '20220905UTbSmth_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                    'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-05-0559_2','CH4Qual':True,
                                            'NH3file':'2022-09-05-0559_1','NH3Qual':True,
                                            'RGBfile':'2022-09-05-1559_0-Jupiter_j220905l1_Michael_Wong'},
                 '20220912UTa':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                           'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-12-0533_4-Jupiter_CH4Abs620.fits','CH4Qual':True,
                                            'NH3file':'2022-09-12-0533_4-Jupiter_NH3Abs647.fits','NH3Qual':True,
                                            'RGBfile':'2022-09-12-0532_3-Jupiter_WV-R685G550B450-RGB-WhtBal-ClrSmth-Wavelets'},
                 '20220912UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-12-0533_4','CH4Qual':True,
                                            'NH3file':'2022-09-12-0533_4','NH3Qual':True,
                                            'RGBfile':'2022-09-12-0532_3-Jupiter_WV-R685G550B450-RGB-WhtBal-ClrSmth-Wavelets'},
                 '20220913UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-13-0457_4','CH4Qual':True,
                                            'NH3file':'2022-09-13-0457_4','NH3Qual':True,
                                            'RGBfile':'2022-09-13-0455_6-Jupiter_WV-R685G550B450-RGB-WhtBal-ClrSmth-Wavelets'},
                 '20220919UTa_Map':{'Telescope':'VLT','FL':' ','Camera':'MUSE',
                                                'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-19-0352_3','CH4Qual':True,
                                            'NH3file':'2022-09-19-0352_3','NH3Qual':True,
                                            'RGBfile':'2022-09-19-0352_3-Jupiter-MUSE-R650G550B450-RGB-WhtBal-Filtered-Wavelets'},
                 '20220919UTb':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                            'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-19-0453_4-Jupiter_CH4Abs620.fits','CH4Qual':True,
                                            'NH3file':'2022-09-19-0453_4-Jupiter_NH3Abs647.fits','NH3Qual':True,
                                            'RGBfile':'2022-09-19-0518_7-Jupiter_WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20220919UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-19-0452_7','CH4Qual':True,
                                            'NH3file':'2022-09-19-0453_4','NH3Qual':True,
                                            'RGBfile':'2022-09-19-0518_7-Jupiter_WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20220925UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-09-25-0615_4','CH4Qual':True,
                                            'NH3file':'2022-09-25-0615_6','NH3Qual':True,
                                            'RGBfile':'2022-09-25-0546_6-Jupiter_WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20221009UTa_Img':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-09-0401_5-Jupiter_620CH4AbsImg.fits','CH4Qual':True,
                                            'NH3file':'2022-10-09-0401_5-Jupiter_647NH3AbsImg.fits','NH3Qual':True,
                                            'RGBfile':'2022-10-09-0339_0-Jupiter_WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20221009UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-09-0401_5','CH4Qual':True,
                                            'NH3file':'2022-10-09-0401_5','NH3Qual':True,
                                            'RGBfile':'2022-10-09-0339_0-Jupiter_WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20221009UTb_Img':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                            'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-09-0524_5-Jupiter_CH4Abs620.fits','CH4Qual':True,
                                            'NH3file':'2022-10-09-0524_5-Jupiter_NH3Abs647.fits','NH3Qual':True,
                                            'RGBfile':'2022-10-09-0542_8-Jupiter_NoWV-R685G550B450-RGB-WhtBal-Str0to160-Wavelets'},
                 '20221009UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-09-0524_5','CH4Qual':True,
                                            'NH3file':'2022-10-09-0524_5','NH3Qual':True,
                                            'RGBfile':'2022-10-09-0542_8-Jupiter_NoWV-R685G550B450-RGB-WhtBal-Str0to160-Wavelets'},
                 '20221013UTa':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                            'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-13-0345_5-Jupiter-CH4Abs620.fits','CH4Qual':True,
                                            'NH3file':'2022-10-13-0345_5-Jupiter-NH3Abs647.fits','NH3Qual':True,
                                            'RGBfile':'2022-10-13-0402_0-Jupiter-WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20221013UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-13-0345_5','CH4Qual':True,
                                            'NH3file':'2022-10-13-0345_5','NH3Qual':True,
                                            'RGBfile':'2022-10-13-0402_0-Jupiter-WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20221019UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-19-0342_4','CH4Qual':True,
                                            'NH3file':'2022-10-19-0342_4','NH3Qual':True,
                                            'RGBfile':'2022-10-19-0358_2-Jupiter-WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20221020UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-20-0440_4','CH4Qual':True,
                                            'NH3file':'2022-10-20-0440_4','NH3Qual':True,
                                            'RGBfile':'2022-10-20-0422_6-Jupiter-WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20221021UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2022-10-21-0358_6','CH4Qual':True,
                                            'NH3file':'2022-10-21-0358_6','NH3Qual':True,
                                            'RGBfile':'2022-10-21-0342_1-Jupiter-WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20230113UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'8/10','Transparency':'7/10', 
                                            'CH4file':'2023-01-13-0046_2','CH4Qual':True,
                                            'NH3file':'2023-01-13-0046_2','NH3Qual':True,
                                            'RGBfile':'2023-01-13-0046_0-Jupiter-WV-R685G550B450-RGB-WhtBal-Wavelets'},
                 '20230815UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'9/10','Transparency':'9/10', 
                                            'CH4file':'2023-08-15-1112_8','CH4Qual':False,
                                            'NH3file':'2023-08-15-1112_8','NH3Qual':False,
                                            'RGBfile':'2023-08-15-1129_3-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20230815UTbSwap_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                   'Seeing':'9/10','Transparency':'9/10', 
                                            'CH4file':'2023-08-15-1112_8-Jupiter_620CH4AbsMapSwap.fits','CH4Qual':False,
                                            'NH3file':'2023-08-15-1112_9-Jupiter_647NH3AbsMapSwap.fits','NH3Qual':False,
                                            'RGBfile':'2023-08-15-1129_3-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20230815UTcGauss632_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                       'Seeing':'9/10','Transparency':'9/10', 
                                            'CH4file':'2023-08-15-1112_8-Jupiter_620CH4AbsMapGauss632CH4.fits','CH4Qual':False,
                                            'NH3file':'2023-08-15-1112_8-Jupiter_647NH3AbsMapGauss632NH3.fits','NH3Qual':False,
                                            'RGBfile':'2023-08-15-1129_3-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20230816UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'7/10','Transparency':'7/10', 
                                            'CH4file':'2023-08-16-1130_1','CH4Qual':True,
                                            'NH3file':'2023-08-16-1130_1','NH3Qual':True,
                                            'RGBfile':'2023-08-16-1145_3-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20230817UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'8/10','Transparency':'7/10', 
                                            'CH4file':'2023-08-17-1121_4','CH4Qual':True,
                                            'NH3file':'2023-08-17-1121_4','NH3Qual':True,
                                            'RGBfile':'2023-08-17-1136_7-Jupiter_R685B550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20230818UTa_Map':{'Telescope':'C11','FL':'5600mm',
                                               'Camera':'ASI120MM','Seeing':'7/10',
                                               'Transparency':'4/10', 
                                            'CH4file':'2023-08-18-1137_1','CH4Qual':True,
                                            'NH3file':'2023-08-18-1137_1','NH3Qual':True,
                                            'RGBfile':'2023-08-18-1151_5-Jupiter_R685B550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20230827UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'10/10','Transparency':'7/10', 
                                            'CH4file':'2023-08-27-1130_6','CH4Qual':True,
                                            'NH3file':'2023-08-27-1130_6','NH3Qual':True,
                                            'RGBfile':'2023-08-27-1144_1-Jupiter_R656B647B632-WV-RGB-WhtBal-ClrSmth-WV-Str0to192'},
                 '20230827UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'10/10','Transparency':'7/10', 
                                            'CH4file':'2023-08-27-1152_6','CH4Qual':False,
                                            'NH3file':'2023-08-27-1153_8','NH3Qual':False,
                                            'RGBfile':'2023-08-27-1144_1-Jupiter_R656B647B632-WV-RGB-WhtBal-ClrSmth-WV-Str0to192'},
                 '20230830UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                               'Seeing':'7/10','Transparency':'7/10', 
                                            'CH4file':'2023-08-30-1144_1','CH4Qual':True,
                                            'NH3file':'2023-08-30-1144_1','NH3Qual':True,
                                            'RGBfile':'2023-08-30-1158_5-Jupiter_R685G550B450-RGB-WhtBal-ClrSmth-WV'},
                 '20230831UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2023-08-31-1130_8','CH4Qual':True,
                                            'NH3file':'2023-08-31-1130_7','NH3Qual':True,
                                            'RGBfile':'2023-08-31-1146_4-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20230831UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2023-08-31-1153_5','CH4Qual':True,
                                            'NH3file':'2023-08-31-1153_7','NH3Qual':False,
                                            'RGBfile':'2023-08-31-1146_4-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20230905UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2023-09-05-1138_3','CH4Qual':True,
                                            'NH3file':'2023-09-05-1138_3','NH3Qual':True,
                                            'RGBfile':'2023-09-05-1152_6-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20230905UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'7/10', 
                                            'CH4file':'2023-09-05-1205_2','CH4Qual':False,
                                            'NH3file':'2023-09-05-1205_2','NH3Qual':False,
                                            'RGBfile':'2023-09-05-1152_6-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20230906UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'8/10', 
                                            'CH4file':'2023-09-06-1134_0','CH4Qual':True,
                                            'NH3file':'2023-09-06-1133_9','NH3Qual':True,
                                            'RGBfile':'2023-09-06-1149_4-Jupiter_R685G550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20230906UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'8/10', 
                                            'CH4file':'2023-09-06-1203_2','CH4Qual':True,
                                            'NH3file':'2023-09-06-1203_2','NH3Qual':True,
                                            'RGBfile':'2023-09-06-1149_4-Jupiter_R685G550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20230922UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'8/10','Transparency':'8/10', 
                                            'CH4file':'2023-09-22-0629_0','CH4Qual':True,
                                            'NH3file':'2023-09-22-0629_0','NH3Qual':True,
                                            'RGBfile':'2023-09-22-0644_8-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20230924UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'4/10','Transparency':'8/10', 
                                            'CH4file':'2023-09-24-1148_0','CH4Qual':True,
                                            'NH3file':'2023-09-24-1148_8','NH3Qual':False,
                                            'RGBfile':'2023-09-24-1208_0-Jupiter_R685G550B450-RGB-WhtBal-ClrSmth-WV'},
                 '20230929UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'8/10', 
                                            'CH4file':'2023-09-29-0532_2','CH4Qual':True,
                                            'NH3file':'2023-09-29-0532_2','NH3Qual':True,
                                            'RGBfile':'2023-09-29-0547_9-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20231005UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'7/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-05-0459_9','CH4Qual':True,
                                            'NH3file':'2023-10-05-0459_9','NH3Qual':True,
                                            'RGBfile':'2023-10-05-0512_7-Jupiter_R685G550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20231006UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'7/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-06-0504_7','CH4Qual':True,
                                            'NH3file':'2023-10-06-0504_7','NH3Qual':True,
                                            'RGBfile':'2023-10-06-0520_8-Jupiter_R685G550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20231006UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'7/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-06-0535_4','CH4Qual':True,
                                            'NH3file':'2023-10-06-0535_4','NH3Qual':True,
                                            'RGBfile':'2023-10-06-0548_9-Jupiter_R685G550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20231015UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'5/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-15-0456_6','CH4Qual':True,
                                            'NH3file':'2023-10-15-0456_6','NH3Qual':True,
                                            'RGBfile':'2023-10-15-0510_2-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20231015UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'5/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-15-0522_6','CH4Qual':True,
                                            'NH3file':'2023-10-15-0522_6','NH3Qual':True,
                                            'RGBfile':'2023-10-15-0536_4-Jupiter_R685G550B450-WV-RGB-WhtBal-ClrSmth-WV'},
                 '20231017UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'8/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-17-0505_7','CH4Qual':True,
                                            'NH3file':'2023-10-17-0505_7','NH3Qual':True,
                                            'RGBfile':'2023-10-17-0520_1-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20231017UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'8/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-17-0533_3','CH4Qual':True,
                                            'NH3file':'2023-10-17-0533_2','NH3Qual':True,
                                            'RGBfile':'2023-10-17-0549_2-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20231019UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-19-0452_2','CH4Qual':True,
                                            'NH3file':'2023-10-19-0452_3','NH3Qual':True,
                                            'RGBfile':'2023-10-19-0507_2-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20231019UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-19-0521_2','CH4Qual':True,
                                            'NH3file':'2023-10-19-0521_2','NH3Qual':True,
                                            'RGBfile':'2023-10-19-0538_1-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV-WV'},
                 '20231022UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'4/10','Transparency':'5/10', 
                                            'CH4file':'2023-10-22-0411_2','CH4Qual':True,
                                            'NH3file':'2023-10-22-0411_2','NH3Qual':True,
                                            'RGBfile':'2023-10-22-0425_0-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20231023UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-23-0417_3','CH4Qual':True,
                                            'NH3file':'2023-10-23-0417_3','NH3Qual':True,
                                            'RGBfile':'2023-10-23-0434_6-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV-WV'},
                 '20231023UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'8/10', 
                                            'CH4file':'2023-10-23-0450_9','CH4Qual':True,
                                            'NH3file':'2023-10-23-0451_0','NH3Qual':True,
                                            'RGBfile':'2023-10-23-0507_2-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV-WV'},
                 '20231024UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'8/10','Transparency':'5/10', 
                                            'CH4file':'2023-10-24-0406_8','CH4Qual':True,
                                            'NH3file':'2023-10-24-0406_4','NH3Qual':True,
                                            'RGBfile':'2023-10-24-0419_1-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20231024UTb_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'8/10','Transparency':'5/10', 
                                            'CH4file':'2023-10-24-0431_2','CH4Qual':True,
                                            'NH3file':'2023-10-24-0431_3','NH3Qual':True,
                                            'RGBfile':'2023-10-24-0444_6-Jupiter_R685G550B450-RGB-ClrSmth-WhtBal-WV'},
                 '20231026UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'6/10','Transparency':'4/10', 
                                            'CH4file':'2023-10-26-0421_3','CH4Qual':True,
                                            'NH3file':'2023-10-26-0421_3','NH3Qual':True,
                                            'RGBfile':'2023-10-26-0433_9-Jupiter_R685G550B450-WV-RGB-ClrSmth-WhtBal-WV'},
                 '20231103UTa_Map':{'Telescope':'C11','FL':'5600mm','Camera':'ASI120MM',
                                             'Seeing':'U/10','Transparency':'U/10', 
                                            'CH4file':'2023-11-03-0353_4','CH4Qual':True,
                                            'NH3file':'2023-11-03-0353_4','NH3Qual':True,
                                            'RGBfile':'2023-11-03-0407_3-Jupiter_R685G550B450-WV-RGB-ClrSmth-WhtBal-WV'},

                 ###Perturbation Study
                 '20220919UTc_Map':{'Telescope':'VLT','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10','Variation':'620Gauss2pix', 
                                            'CH4file':'2022-09-19-0352_3','CH4Qual':False,
                                            'NH3file':'2022-09-19-0352_3','NH3Qual':False,
                                            'RGBfile':'2022-09-19-0352_3-Jupiter-MUSE-R650G550B450-RGB-WhtBal-Filtered-Wavelets'},
                 '20220919UTd_Map':{'Telescope':'VLT','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10','Variation':'647Gauss2pix', 
                                            'CH4file':'2022-09-19-0352_3','CH4Qual':False,
                                            'NH3file':'2022-09-19-0352_3','NH3Qual':False,
                                            'RGBfile':'2022-09-19-0352_3-Jupiter-MUSE-R650G550B450-RGB-WhtBal-Filtered-Wavelets'},
                 '20220919UTe_Map':{'Telescope':'VLT','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10','Variation':'632Gauss2pix', 
                                            'CH4file':'2022-09-19-0352_3','CH4Qual':False,
                                            'NH3file':'2022-09-19-0352_3','NH3Qual':False,
                                            'RGBfile':'2022-09-19-0352_3-Jupiter-MUSE-R650G550B450-RGB-WhtBal-Filtered-Wavelets'},
                 '20220919UTf_Map':{'Telescope':'VLT','FL':'5600mm','Camera':'ASI120MM',
                                                'Seeing':'6/10','Transparency':'7/10','Variation':'656Gauss2pix', 
                                            'CH4file':'2022-09-19-0352_3','CH4Qual':False,
                                            'NH3file':'2022-09-19-0352_3','NH3Qual':False,
                                            'RGBfile':'2022-09-19-0352_3-Jupiter-MUSE-R650G550B450-RGB-WhtBal-Filtered-Wavelets'}
                 
                 }

    """
    if writejson:
        filename="C:/Astronomy/Projects/SAS 2021 Ammonia/Jupiter_NH3_Analysis_P3/L2FITS.json"
        with open(filename, "w") as fp:
            json.dump(sourcefiles , fp) 
    print("TEST0")

    if writecsv:
        filename="C:/Astronomy/Projects/SAS 2021 Ammonia/Jupiter_NH3_Analysis_P3/L2FITS.csv"
    
        t = Table(names=('ObsID', 'NH3 Time','CM1','CM2','CM3',
                         'Telescope','FL','Camera','Seeing','Transparency',
                         'CH4 Abs / PCloud','CH4 Qual','NH3 Abs / fc(NH3)','NH3Qual','RGB Context'),
                  dtype=('S10','S10','S10','S10','S10',
                         'S10','S10','S10','S10','S10',
                         'S10','B','S10','B','S10'))
    
    
        for ObsID in sourcefiles:
            print(ObsID)
            #for item in sourcefiles[ObsID]:
            #    print(item)
            NH3sec=str(int(str(sourcefiles[ObsID]["NH3file"][16:17]))*6)
            NH3time=(sourcefiles[ObsID]["NH3file"][0:10]+"_"+
                     sourcefiles[ObsID]["NH3file"][11:13]+":"+
                     sourcefiles[ObsID]["NH3file"][13:15]+":"+NH3sec.zfill(2))
            eph=WJ_ephem.get_WINJupos_ephem(NH3time)
            NH3_CM1=float(eph[0].strip())
            NH3_CM2=float(eph[1].strip())
            NH3_CM3=float(eph[2].strip())

            print(ObsID,sourcefiles[ObsID]["Telescope"],
                       sourcefiles[ObsID]["FL"],sourcefiles[ObsID]["Camera"],
                       sourcefiles[ObsID]["Seeing"],sourcefiles[ObsID]["Transparency"],
                       sourcefiles[ObsID]["CH4file"],sourcefiles[ObsID]["CH4Qual"],
                       sourcefiles[ObsID]["NH3file"],sourcefiles[ObsID]["NH3Qual"],
                       sourcefiles[ObsID]["RGBfile"])
            if "Map" in ObsID:
                t.add_row((ObsID,NH3time,str(NH3_CM1),str(NH3_CM2),str(NH3_CM3),
                           sourcefiles[ObsID]["Telescope"],
                           sourcefiles[ObsID]["FL"],sourcefiles[ObsID]["Camera"],
                           "'"+sourcefiles[ObsID]["Seeing"]+"'","'"+sourcefiles[ObsID]["Transparency"]+"'",
                           sourcefiles[ObsID]["CH4file"],sourcefiles[ObsID]["CH4Qual"],
                           sourcefiles[ObsID]["NH3file"],sourcefiles[ObsID]["NH3Qual"],
                           sourcefiles[ObsID]["RGBfile"]))
        print("TEST1")
        CM1array=np.array(t['CM1']).astype(float)
        CM2array=np.array(t['CM2']).astype(float)
        CM3array=np.array(t['CM3']).astype(float)
        #for i in range(0,tarray.size):
        #    print(tarray[i])
        #print("** ",tarray.size)
        histCM1,binedgesCM1=np.histogram(CM1array,bins=np.linspace(0,360,num=36,
                                                           endpoint=True))
        histCM2,binedgesCM2=np.histogram(CM2array,bins=np.linspace(0,360,num=36,
                                                           endpoint=True))
        histCM3,binedgesCM3=np.histogram(CM3array,bins=np.linspace(0,360,num=36,
                                                           endpoint=True))
        #print("TEST2")
        #print(hist)
        bincenters = [(binedgesCM1[i]+binedgesCM1[i+1])/2. for i in range(len(binedgesCM1)-1)]
        fig,axs=pl.subplots(3,1,figsize=(6.0,6.0), dpi=150, facecolor="white",
                            sharey=True,sharex=True)

        axs[0].step(bincenters, histCM1)
        axs[0].set_xlim(0,360)
        axs[0].set_xticks(np.linspace(0,360,num=13))
        axs[0].set_ylim(0,10)
        axs[0].set_yticks(np.linspace(0,10,num=6))
        axs[1].step(bincenters, histCM2)
        axs[2].step(bincenters, histCM3)
        
        ascii.write(t,filename,format='basic',overwrite=True,delimiter=',')
        """
    return(sourcefiles)